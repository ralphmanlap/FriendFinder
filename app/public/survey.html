<!DOCTYPE html>
<html>
<head>
	<title>Survey</title>
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">
	<script src="https://code.jquery.com/jquery-2.2.3.min.js"   integrity="sha256-a23g1Nt4dtEYOj7bR+vTu7+T8VP13humZFBJNIYoEJo="   crossorigin="anonymous"></script>
	<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.0.0-alpha/js/bootstrap.min.js"></script>
</head>
<body>
	<div class="container">
		<form method="post" action="/api/friends">
			<fieldset class="form-group row">
				<label for="name" class="col-sm-5">Name: </label>
			    <div class="col-sm-7">
		    		<input type="text" class="form-control" name="name" id="name" placeholder="your name">
			    </div>
			</fieldset>
			<fieldset class="form-group row">
		    	<label for="select1" class="col-sm-7">Your mind is always buzzing with unexplored ideas and plans.</label>
			    <div class="col-sm-5">
				    <select class="form-control" name="0" id="select1">
				    	<option>1</option>
					    <option>2</option>
					    <option>3</option>
					    <option>4</option>
			    		<option>5</option>
			    	</select>
		    	</div>
		  	</fieldset>
		  	<fieldset class="form-group row">
		    	<label for="select8" class="col-sm-7">You rarely get carried away by fantasies and ideas.</label>
			    <div class="col-sm-5">
				    <select class="form-control" name="7" id="select8">
				    	<option>1</option>
					    <option>2</option>
					    <option>3</option>
					    <option>4</option>
			    		<option>5</option>
			    	</select>
		    	</div>
		  	</fieldset>
		  	<fieldset class="form-group row">
		    	<label for="select3" class="col-sm-7">You find it easy to stay relaxed and focused even when there is some pressure.</label>
			    <div class="col-sm-5">
				    <select class="form-control" name="2" id="select3">
				    	<option>1</option>
					    <option>2</option>
					    <option>3</option>
					    <option>4</option>
			    		<option>5</option>
			    	</select>
		    	</div>
		  	</fieldset>
		  	<fieldset class="form-group row">
		    	<label for="select4" class="col-sm-7">You rarely do something just out of sheer curiosity.</label>
			    <div class="col-sm-5">
				    <select class="form-control" name="3" id="select4">
				    	<option>1</option>
					    <option>2</option>
					    <option>3</option>
					    <option>4</option>
			    		<option>5</option>
			    	</select>
		    	</div>
		  	</fieldset>
		  	<fieldset class="form-group row">
		    	<label for="select5" class="col-sm-7">People can rarely upset you.</label>
			    <div class="col-sm-5">
				    <select class="form-control" name="4" id="select5">
				    	<option>1</option>
					    <option>2</option>
					    <option>3</option>
					    <option>4</option>
			    		<option>5</option>
			    	</select>
		    	</div>
		  	</fieldset>
		  	<fieldset class="form-group row">
		    	<label for="select2" class="col-sm-7">Generally speaking, you rely more on your experience than your imagination.</label>
			    <div class="col-sm-5">
				    <select class="form-control" name="1" id="select2">
				    	<option>1</option>
					    <option>2</option>
					    <option>3</option>
					    <option>4</option>
			    		<option>5</option>
			    	</select>
		    	</div>
		  	</fieldset>
		  	<fieldset class="form-group row">
		    	<label for="select6" class="col-sm-7">It is often difficult for you to relate to other people’s feelings.</label>
			    <div class="col-sm-5">
				    <select class="form-control" name="5" id="select6">
				    	<option>1</option>
					    <option>2</option>
					    <option>3</option>
					    <option>4</option>
			    		<option>5</option>
			    	</select>
		    	</div>
		  	</fieldset>
		  	<fieldset class="form-group row">
		    	<label for="select7" class="col-sm-7">In a discussion, truth should be more important than people’s sensitivities.</label>
			    <div class="col-sm-5">
				    <select class="form-control" name="6" id="select7">
				    	<option>1</option>
					    <option>2</option>
					    <option>3</option>
					    <option>4</option>
			    		<option>5</option>
			    	</select>
		    	</div>
		  	</fieldset>
		  	
		  	<fieldset class="form-group row">
		    	<label for="select9" class="col-sm-7">You think that everyone’s views should be respected regardless of whether they are supported by facts or not.</label>
			    <div class="col-sm-5">
				    <select class="form-control" name="8" id="select9">
				    	<option>1</option>
					    <option>2</option>
					    <option>3</option>
					    <option>4</option>
			    		<option>5</option>
			    	</select>
		    	</div>
		  	</fieldset>
		  	<fieldset class="form-group row">
		    	<label for="select10" class="col-sm-7">You feel more energetic after spending time with a group of people.</label>
			    <div class="col-sm-5">
				    <select class="form-control" name="9" id="select10">
				    	<option>1</option>
					    <option>2</option>
					    <option>3</option>
					    <option>4</option>
			    		<option>5</option>
			    	</select>
		    	</div>
		  	</fieldset>
		  	<hr>
		  <button type="submit" class="btn btn-primary" data-toggle="modal" disabled="disabled" data-target="#myModal" id="modalButton">Submit</button>
		</form>
	</div>
	<!-- Modal -->
	<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
	  <div class="modal-dialog" role="document">
	    <div class="modal-content">
	      <div class="modal-header">
	        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
	        <h4 class="modal-title" id="myModalLabel">Your Friendly Match!</h4>
	      </div>
	      <div class="modal-body" id="matchBody">
	        <h2>Not enough Data :(</h2>
	      </div>
	      <div class="modal-footer">
	        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
	        <a href="/api/friends"><button type="button" class="btn btn-default">View Api</button></a>
	      </div>
	    </div>
	  </div>
	</div>
</body>
<script type="text/javascript">
$(document).ready(function(){
	var empty = true;

	$('#name').keyup(function(){
		if (/[a-z]{5,24}/ig.test($(this).val())) {
			empty = false;
			check();
		} else {
			empty = true;
		}
	})
    function check(){    	
	    if (empty) {
	        $('#modalButton').attr('disabled', 'disabled'); 
	    } else {
	        $('#modalButton').removeAttr('disabled'); 
	    }
	};
	$('#modalButton').on('click', function(){
		var closest = Infinity;
		var yourScore = [
			$('#select1').val(),
			$('#select2').val(),
			$('#select3').val(),
			$('#select4').val(),
			$('#select5').val(),
			$('#select6').val(),
			$('#select7').val(),
			$('#select8').val(),
			$('#select9').val(),
			$('#select10').val()
		];
		yourScore.forEach(function(e,i,a){
			a[i] = Number(e);
		})
		yourScore = yourScore.reduce(function(a, b) {
	  			return a + b;
			});
		$.ajax({
    	url: '/api/friends',
    	method: 'GET'})
    	.done(function(response) {
    		if (response.length > 0) {
	    		for (var i = 0; i < response.length; i++) {
					var friendScore = response[i].scores.reduce(function(a, b) {
		  				return a + b;
					});
					if (Math.abs(yourScore - friendScore) < closest) {
						bestMatch = response[i].name;
						bestMatchPhoto = response[i].photo;
						closest = Math.abs(yourScore - friendScore);
					}
	    		}
	    		$('#matchBody').html('<h2>Your match is ' + bestMatch + '!</h2><h3>Your scores were within ' + closest + ' points.</h3>')
	   		}
		});
    })
})
</script>
</html>